local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local Library = {}
Library.Windows = {}

-- Window Class
local Window = {}
Window.__index = Window

function Window.new(title, options)
	local player = Players.LocalPlayer
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "BetterEleriumUIPreview"
	screenGui.ResetOnSpawn = false
	screenGui.Parent = player:WaitForChild("PlayerGui")

	local main = Instance.new("Frame")
	main.Size = UDim2.new(0, options.min_size.X, 0, options.min_size.Y)
	main.Position = UDim2.new(0.5, 0, 0.5, 0)
	main.AnchorPoint = Vector2.new(0.5, 0.5)
	main.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	main.BorderSizePixel = 0
	main.Active = true
	main.Draggable = true
	main.Parent = screenGui

	local topbar = Instance.new("Frame")
	topbar.Size = UDim2.new(1, 0, 0, 30)
	topbar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
	topbar.BorderSizePixel = 0
	topbar.Parent = main

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Text = title
	titleLabel.Font = Enum.Font.GothamSemibold
	titleLabel.TextSize = 14
	titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Size = UDim2.new(1, -40, 1, 0)
	titleLabel.Position = UDim2.new(0, 10, 0, 0)
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left
	titleLabel.Parent = topbar

	local minimize = Instance.new("TextButton")
	minimize.Text = "-"
	minimize.Font = Enum.Font.GothamBold
	minimize.TextSize = 16
	minimize.TextColor3 = Color3.fromRGB(255, 255, 255)
	minimize.BackgroundTransparency = 1
	minimize.Size = UDim2.new(0, 30, 0, 30)
	minimize.Position = UDim2.new(1, -30, 0, 0)
	minimize.BorderSizePixel = 0
	minimize.AutoButtonColor = false
	minimize.SelectionImageObject = Instance.new("ImageLabel")
	minimize.SelectionImageObject.BackgroundTransparency = 1
	minimize.Parent = topbar

	local tabPanel = Instance.new("Frame")
	tabPanel.Size = UDim2.new(0, 120, 1, -30)
	tabPanel.Position = UDim2.new(0, 0, 0, 30)
	tabPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	tabPanel.BorderSizePixel = 0
	tabPanel.Name = "TabPanel"
	tabPanel.Parent = main

	local tabList = Instance.new("UIListLayout")
	tabList.SortOrder = Enum.SortOrder.LayoutOrder
	tabList.Padding = UDim.new(0, 5)
	tabList.Parent = tabPanel

	local contentPanel = Instance.new("Frame")
	contentPanel.Size = UDim2.new(1, -120, 1, -30)
	contentPanel.Position = UDim2.new(0, 120, 0, 30)
	contentPanel.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	contentPanel.BorderSizePixel = 0
	contentPanel.Name = "ContentPanel"
	contentPanel.ClipsDescendants = true
	contentPanel.Parent = main

	local tabs = {}
	local minimized = false

	minimize.MouseButton1Click:Connect(function()
		minimized = not minimized
		local targetSize = minimized and UDim2.new(0, options.min_size.X, 0, 30) or UDim2.new(0, options.min_size.X, 0, options.min_size.Y)
		TweenService:Create(main, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = targetSize}):Play()
		tabPanel.Visible = not minimized
		contentPanel.Visible = not minimized
	end)

	local self = setmetatable({
		ScreenGui = screenGui,
		Main = main,
		TabPanel = tabPanel,
		ContentPanel = contentPanel,
		Tabs = tabs,
		Minimized = minimized
	}, Window)

	return self
end

function Window:AddTab(name)
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, -10, 0, 30)
	button.Text = name
	button.Font = Enum.Font.GothamBold
	button.TextSize = 14
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	button.BorderSizePixel = 0
	button.AutoButtonColor = false
	button.SelectionImageObject = Instance.new("ImageLabel")
	button.SelectionImageObject.BackgroundTransparency = 1
	button.Parent = self.TabPanel

	local content = Instance.new("Frame")
	content.Size = UDim2.new(1, -20, 1, -20)
	content.Position = UDim2.new(0, 10, 0, 10)
	content.BackgroundTransparency = 1
	content.Visible = false
	content.Name = name .. "_Content"
	content.Parent = self.ContentPanel

	self.Tabs[name] = content

	local list = Instance.new("UIListLayout")
	list.SortOrder = Enum.SortOrder.LayoutOrder
	list.Padding = UDim.new(0, 10)
	list.Parent = content

	button.MouseButton1Click:Connect(function()
		for tabName, tabFrame in pairs(self.Tabs) do
			tabFrame.Visible = (tabName == name)
		end
	end)

	if #self.Tabs == 1 then
		content.Visible = true
	end

	return {
		Content = content,
		AddToggle = function(label, callback)
			local toggle = Instance.new("TextButton")
			toggle.Text = label .. ": OFF"
			toggle.Font = Enum.Font.Gotham
			toggle.TextSize = 14
			toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
			toggle.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
			toggle.Size = UDim2.new(1, 0, 0, 30)
			toggle.AutoButtonColor = false
			toggle.SelectionImageObject = Instance.new("ImageLabel")
			toggle.SelectionImageObject.BackgroundTransparency = 1
			toggle.Parent = content

			local toggled = false
			toggle.MouseButton1Click:Connect(function()
				toggled = not toggled
				toggle.Text = toggled and (label .. ": ON") or (label .. ": OFF")
				if callback then callback(toggled) end
			end)
			return toggle
		end,
		AddTextBox = function(placeholder, callback)
			local textbox = Instance.new("TextBox")
			textbox.PlaceholderText = placeholder
			textbox.Text = ""
			textbox.ClearTextOnFocus = true
			textbox.Font = Enum.Font.Gotham
			textbox.TextSize = 14
			textbox.TextColor3 = Color3.fromRGB(255, 255, 255)
			textbox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
			textbox.Size = UDim2.new(1, 0, 0, 30)
			textbox.BorderSizePixel = 0
			textbox.SelectionImageObject = Instance.new("ImageLabel")
			textbox.SelectionImageObject.BackgroundTransparency = 1
			textbox.Parent = content

			textbox.Changed:Connect(function()
				if callback then callback(textbox.Text) end
			end)
			return textbox
		end,
		AddDropdown = function(label, callback)
			local dropdown = Instance.new("TextButton")
			dropdown.Text = label .. " â–¼"
			dropdown.Font = Enum.Font.Gotham
			dropdown.TextSize = 14
			dropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
			dropdown.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
			dropdown.Size = UDim2.new(1, 0, 0, 30)
			dropdown.AutoButtonColor = false
			dropdown.SelectionImageObject = Instance.new("ImageLabel")
			dropdown.SelectionImageObject.BackgroundTransparency = 1
			dropdown.Parent = content

			local dropFrame = Instance.new("Frame")
			dropFrame.Size = UDim2.new(1, 0, 0, 0)
			dropFrame.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
			dropFrame.ClipsDescendants = true
			dropFrame.BorderSizePixel = 0
			dropFrame.Parent = content

			local dropList = Instance.new("UIListLayout")
			dropList.SortOrder = Enum.SortOrder.LayoutOrder
			dropList.Padding = UDim.new(0, 2)
			dropList.Parent = dropFrame

			local dropOpen = false
			local options = {}

			dropdown.MouseButton1Click:Connect(function()
				dropOpen = not dropOpen
				local targetSize = dropOpen and UDim2.new(1, 0, 0, #options * 25 + 2) or UDim2.new(1, 0, 0, 0)
				TweenService:Create(dropFrame, TweenInfo.new(0.25), {Size = targetSize}):Play()
			end)

			return {
				Add = function(optionText)
					local option = Instance.new("TextButton")
					option.Text = optionText
					option.Font = Enum.Font.Gotham
					option.TextSize = 14
					option.TextColor3 = Color3.fromRGB(255, 255, 255)
					option.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
					option.Size = UDim2.new(1, 0, 0, 25)
					option.AutoButtonColor = false
					option.SelectionImageObject = Instance.new("ImageLabel")
					option.SelectionImageObject.BackgroundTransparency = 1
					option.Parent = dropFrame

					table.insert(options, option)

					option.MouseButton1Click:Connect(function()
						dropdown.Text = label .. " " .. optionText
						dropOpen = false
						TweenService:Create(dropFrame, TweenInfo.new(0.25), {Size = UDim2.new(1, 0, 0, 0)}):Play()
						if callback then callback(optionText) end
					end)
					return option
				end
			}
		end
	}
end

-- Library Methods
function Library:AddWindow(title, options)
	options = options or {}
	options.min_size = options.min_size or Vector2.new(600, 450)
	options.main_color = options.main_color or Color3.fromRGB(25, 25, 25)

	local window = Window.new(title, options)
	table.insert(Library.Windows, window)
	return window
end

return Library
