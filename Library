local library = {}

function library:AddWindow(titleText, options)
    local main_color = options.main_color or Color3.fromRGB(41, 74, 122) -- Default color for the top bar and minimize button
    local min_size = options.min_size or Vector2.new(600, 350)
    local can_resize = options.can_resize or false

    -- Create the GUI container
    local player = game:GetService("Players").LocalPlayer
    local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    gui.Name = "lume"

    -- Create the main frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, min_size.X, 0, min_size.Y)
    mainFrame.Position = UDim2.new(0.5, -min_size.X/2, 0.5, -min_size.Y/2)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)  -- Main frame stays grey (unchanged)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = gui
    mainFrame.Active = true
    mainFrame.Draggable = true

    -- UICorner for rounded edges on the main frame
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = mainFrame

    -- Create the top bar
    local topBar = Instance.new("Frame")
    topBar.Size = UDim2.new(1, 0, 0, 30)
    topBar.BackgroundColor3 = main_color  -- Top bar color matches main_color
    topBar.BorderSizePixel = 0
    topBar.Parent = mainFrame

    -- Create the title label
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(0, 200, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = titleText  -- Use the titleText argument
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamSemibold
    title.TextSize = 14
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = topBar

    -- Create the minimize button
    local minimizeButton = Instance.new("TextButton")
    minimizeButton.Size = UDim2.new(0, 30, 0, 30)
    minimizeButton.Position = UDim2.new(1, -35, 0, 0)
    minimizeButton.BackgroundColor3 = main_color  -- Minimize button color also changes to match top bar
    minimizeButton.Text = "â†‘"
    minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    minimizeButton.Font = Enum.Font.GothamSemibold
    minimizeButton.TextSize = 18
    minimizeButton.BorderSizePixel = 0
    minimizeButton.Parent = topBar

    -- Create the content holder
    local contentHolder = Instance.new("Frame")
    contentHolder.Name = "ContentHolder"
    contentHolder.Size = UDim2.new(1, 0, 1, -30)
    contentHolder.Position = UDim2.new(0, 0, 0, 30)
    contentHolder.BackgroundTransparency = 1
    contentHolder.Parent = mainFrame

    -- Create tab holder
    local tabList = Instance.new("Frame")
    tabList.Name = "TabList"
    tabList.Size = UDim2.new(0, 120, 1, 0)
    tabList.Position = UDim2.new(0, 0, 0, 0)
    tabList.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    tabList.BorderSizePixel = 0
    tabList.Parent = contentHolder

    -- Create tab content frame
    local tabContent = Instance.new("Frame")
    tabContent.Name = "TabContent"
    tabContent.Size = UDim2.new(1, -120, 1, 0)
    tabContent.Position = UDim2.new(0, 120, 0, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.Parent = contentHolder

    -- Tab functionality
    local UIListLayout = Instance.new("UIListLayout", tabList)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.Padding = UDim.new(0, 4)

    local tabs = {}

    local function switchTab(selectedTab)
        for _, tab in ipairs(tabs) do
            tab.content.Visible = (tab == selectedTab)
            tab.button.BackgroundColor3 = tab == selectedTab and main_color or Color3.fromRGB(25, 25, 25)
        end
    end

    local function AddTab(name)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, -10, 0, 30)
        button.Position = UDim2.new(0, 5, 0, 0)
        button.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
        button.BorderSizePixel = 0
        button.Text = name
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.Font = Enum.Font.Gotham
        button.TextSize = 14
        button.Parent = tabList

        local corner = Instance.new("UICorner", button)
        corner.CornerRadius = UDim.new(0, 6)

        local content = Instance.new("Frame")
        content.Name = name .. "_Content"
        content.Size = UDim2.new(1, 0, 1, 0)
        content.BackgroundTransparency = 1
        content.Visible = false
        content.Parent = tabContent

        local tab = {button = button, content = content}
        table.insert(tabs, tab)

        button.MouseButton1Click:Connect(function()
            switchTab(tab)
        end)

        if #tabs == 1 then
            switchTab(tab)
        end

        return content -- Return content holder so user can add UI to it
    end

    -- Return window object or any other elements you'd like to use
    return {
        mainFrame = mainFrame,
        topBar = topBar,
        minimizeButton = minimizeButton,
        title = title,
        AddTab = AddTab
    }
end

return library
