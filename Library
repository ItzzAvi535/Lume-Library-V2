local Library = {}

local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local player = game:GetService("Players").LocalPlayer

function Library:CreateWindow(title)
    -- Clean up any old intro
    pcall(function() CoreGui:FindFirstChild("LumeIntro"):Destroy() end)

    -- Create GUI container for intro
    local gui = Instance.new("ScreenGui")
    gui.Name = "LumeIntro"
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Parent = CoreGui

    -- Background fade
    local bg = Instance.new("Frame")
    bg.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    bg.Size = UDim2.new(1, 0, 1, 0)
    bg.BackgroundTransparency = 1
    bg.Parent = gui

    -- Text
    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(1, 0, 1, 0)
    text.Position = UDim2.new(0.5, 0, 0.5, 0)
    text.AnchorPoint = Vector2.new(0.5, 0.5)
    text.Text = "Lume Library V2"
    text.TextColor3 = Color3.fromRGB(255, 255, 255)
    text.BackgroundTransparency = 1
    text.TextScaled = true
    text.Font = Enum.Font.GothamBlack
    text.TextTransparency = 1
    text.Parent = gui

    -- Shadow layer
    local shadow = text:Clone()
    shadow.TextColor3 = Color3.fromRGB(255, 0, 80)
    shadow.TextTransparency = 1
    shadow.ZIndex = 0
    shadow.Position = text.Position + UDim2.new(0, 3, 0, 3)
    shadow.Parent = gui

    -- Animate in
    TweenService:Create(bg, TweenInfo.new(1, Enum.EasingStyle.Quad), {BackgroundTransparency = 0.1}):Play()
    TweenService:Create(text, TweenInfo.new(1, Enum.EasingStyle.Quad), {TextTransparency = 0}):Play()
    TweenService:Create(shadow, TweenInfo.new(1, Enum.EasingStyle.Quad), {TextTransparency = 0.2}):Play()

    -- Pulse loop
    task.spawn(function()
        while gui and gui.Parent do
            TweenService:Create(text, TweenInfo.new(1, Enum.EasingStyle.Sine), {TextSize = 110}):Play()
            wait(1)
            TweenService:Create(text, TweenInfo.new(1, Enum.EasingStyle.Sine), {TextSize = 100}):Play()
            wait(1)
        end
    end)

    -- Exit after a few seconds, then show the UI
    task.delay(6, function()
        if gui then
            TweenService:Create(bg, TweenInfo.new(1), {BackgroundTransparency = 1}):Play()
            TweenService:Create(text, TweenInfo.new(1), {TextTransparency = 1}):Play()
            TweenService:Create(shadow, TweenInfo.new(1), {TextTransparency = 1}):Play()
            wait(1.2)
            gui:Destroy()

            -- Now create the main UI window
            local playerGui = player:WaitForChild("PlayerGui")
            local screenGui = Instance.new("ScreenGui", playerGui)
            screenGui.Name = "LumeUI"
            screenGui.ResetOnSpawn = false

            local mainFrame = Instance.new("Frame")
            mainFrame.Size = UDim2.new(0, 600, 0, 400)
            mainFrame.Position = UDim2.new(0.5, -300, 0.5, -200)
            mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            mainFrame.BackgroundTransparency = 0.3
            mainFrame.BorderSizePixel = 0
            mainFrame.Active = true
            mainFrame.Draggable = true
            mainFrame.Parent = screenGui

            Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)

            local titleLabel = Instance.new("TextLabel")
            titleLabel.Size = UDim2.new(1, -60, 0, 40)
            titleLabel.Position = UDim2.new(0, 10, 0, 0)
            titleLabel.BackgroundTransparency = 1
            titleLabel.Text = title or "Lume UI"
            titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            titleLabel.Font = Enum.Font.GothamBold
            titleLabel.TextSize = 22
            titleLabel.TextXAlignment = Enum.TextXAlignment.Left
            titleLabel.Parent = mainFrame

            local closeBtn = Instance.new("TextButton")
            closeBtn.Size = UDim2.new(0, 30, 0, 30)
            closeBtn.Position = UDim2.new(1, -35, 0, 5)
            closeBtn.Text = "X"
            closeBtn.TextColor3 = Color3.fromRGB(255, 0, 0)
            closeBtn.BackgroundTransparency = 1
            closeBtn.Font = Enum.Font.GothamBold
            closeBtn.TextSize = 18
            closeBtn.Parent = mainFrame
            closeBtn.MouseButton1Click:Connect(function()
                screenGui:Destroy()
            end)

            local minimizeBtn = Instance.new("TextButton")
            minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
            minimizeBtn.Position = UDim2.new(1, -70, 0, 5)
            minimizeBtn.Text = "-"
            minimizeBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
            minimizeBtn.BackgroundTransparency = 1
            minimizeBtn.Font = Enum.Font.GothamBold
            minimizeBtn.TextSize = 22
            minimizeBtn.Parent = mainFrame

            local contentFrame = Instance.new("Frame")
            contentFrame.Position = UDim2.new(0, 120, 0, 40)
            contentFrame.Size = UDim2.new(1, -130, 1, -50)
            contentFrame.BackgroundTransparency = 1
            contentFrame.Name = "ContentFrame"
            contentFrame.Parent = mainFrame

            local tabList = Instance.new("Frame")
            tabList.Size = UDim2.new(0, 110, 1, -40)
            tabList.Position = UDim2.new(0, 5, 0, 40)
            tabList.BackgroundTransparency = 1
            tabList.Name = "TabList"
            tabList.Parent = mainFrame

            local tabLayout = Instance.new("UIListLayout", tabList)
            tabLayout.Padding = UDim.new(0, 6)
            tabLayout.SortOrder = Enum.SortOrder.LayoutOrder

            local separatorLine = Instance.new("Frame")
            separatorLine.Size = UDim2.new(0, 1, 1, -40)
            separatorLine.Position = UDim2.new(0, 115, 0, 40)
            separatorLine.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
            separatorLine.BorderSizePixel = 0
            separatorLine.Parent = mainFrame

            local isMinimized = false
            minimizeBtn.MouseButton1Click:Connect(function()
                isMinimized = not isMinimized
                contentFrame.Visible = not isMinimized
                tabList.Visible = not isMinimized
                separatorLine.Visible = not isMinimized
                if isMinimized then
                    mainFrame.Size = UDim2.new(0, 600, 0, 50)
                else
                    mainFrame.Size = UDim2.new(0, 600, 0, 400)
                end
            end)

            local currentTab

            local window = {}

            function window:AddTab(tabName)
                local tab = {}

                local tabBtn = Instance.new("TextButton")
                tabBtn.Size = UDim2.new(1, 0, 0, 30)
                tabBtn.Text = tabName
                tabBtn.BackgroundTransparency = 1
                tabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
                tabBtn.Font = Enum.Font.GothamBold
                tabBtn.TextSize = 16
                tabBtn.Parent = tabList

                local line = Instance.new("Frame")
                line.Size = UDim2.new(1, 0, 0, 1)
                line.Position = UDim2.new(0, 0, 1, 0)
                line.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
                line.BorderSizePixel = 0
                line.Parent = tabBtn

                local tabFrame = Instance.new("Frame")
                tabFrame.Size = UDim2.new(1, 0, 1, 0)
                tabFrame.BackgroundTransparency = 1
                tabFrame.Visible = false
                tabFrame.Parent = contentFrame

                local layout = Instance.new("UIListLayout", tabFrame)
                layout.Padding = UDim.new(0, 6)

                tabBtn.MouseButton1Click:Connect(function()
                    if currentTab then
                        currentTab.Visible = false
                    end
                    tabFrame.Visible = true
                    currentTab = tabFrame
                end)

                function tab:AddButton(text, callback)
                    local button = Instance.new("TextButton")
                    button.Size = UDim2.new(0, 180, 0, 30)
                    button.Position = UDim2.new(0.5, -90, 0, 30)
                    button.Text = text
                    button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                    button.TextColor3 = Color3.fromRGB(255, 255, 255)
                    button.Font = Enum.Font.Gotham
                    button.TextSize = 14
                    button.Parent = tabFrame

                    button.MouseButton1Click:Connect(callback)
                end

                return tab
            end

            return window
        end
    end)

    return Library
end

return Library
