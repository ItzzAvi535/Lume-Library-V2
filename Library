-- Lume Library V2 ModuleScript
local library = {}

-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

-- Local Player
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Helper Function: Create Tween
local function createTween(element, properties, duration, easingStyle)
    easingStyle = easingStyle or Enum.EasingStyle.Quad
    local tweenInfo = TweenInfo.new(duration, easingStyle, Enum.EasingDirection.Out)
    local tween = TweenService:Create(element, tweenInfo, properties)
    tween:Play()
end

-- Library Functions
function library:AddWindow(title, config)
    config = config or {}
    local mainColor = config.main_color or Color3.fromRGB(41, 74, 122)
    local mainSize = config.main_size or Vector2.new(600, 340)
    local keySystem = config.Key_system or false
    local key = config.Key or "Avi"

    -- Create ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "LumeLibraryV2"
    screenGui.Parent = playerGui
    screenGui.ResetOnSpawn = false

    -- Key System Frame
    local keyFrame = Instance.new("Frame")
    keyFrame.Size = UDim2.new(0, 300, 0, 200)
    keyFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
    keyFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    keyFrame.BorderSizePixel = 0
    keyFrame.Parent = screenGui
    keyFrame.Visible = keySystem

    local keyStroke = Instance.new("UIStroke")
    keyStroke.Thickness = 2
    keyStroke.Color = mainColor
    keyStroke.Parent = keyFrame

    local keyCorner = Instance.new("UICorner")
    keyCorner.CornerRadius = UDim.new(0, 10)
    keyCorner.Parent = keyFrame

    local keyTitle = Instance.new("TextLabel")
    keyTitle.Size = UDim2.new(1, 0, 0, 40)
    keyTitle.Position = UDim2.new(0, 0, 0, 10)
    keyTitle.BackgroundTransparency = 1
    keyTitle.Text = "Enter Key"
    keyTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    keyTitle.Font = Enum.Font.GothamBold
    keyTitle.TextSize = 20
    keyTitle.Parent = keyFrame

    local keyInput = Instance.new("TextBox")
    keyInput.Size = UDim2.new(0.8, 0, 0, 40)
    keyInput.Position = UDim2.new(0.1, 0, 0.4, 0)
    keyInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    keyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    keyInput.PlaceholderText = "Input Key Here"
    keyInput.Font = Enum.Font.Gotham
    keyInput.TextSize = 16
    keyInput.Parent = keyFrame

    local keyInputCorner = Instance.new("UICorner")
    keyInputCorner.CornerRadius = UDim.new(0, 5)
    keyInputCorner.Parent = keyInput

    local keySubmit = Instance.new("TextButton")
    keySubmit.Size = UDim2.new(0.8, 0, 0, 40)
    keySubmit.Position = UDim2.new(0.1, 0, 0.7, 0)
    keySubmit.BackgroundColor3 = mainColor
    keySubmit.Text = "Submit"
    keySubmit.TextColor3 = Color3.fromRGB(255, 255, 255)
    keySubmit.Font = Enum.Font.GothamBold
    keySubmit.TextSize = 16
    keySubmit.Parent = keyFrame

    local keySubmitCorner = Instance.new("UICorner")
    keySubmitCorner.CornerRadius = UDim.new(0, 5)
    keySubmitCorner.Parent = keySubmit

    -- Main UI Frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, mainSize.X, 0, mainSize.Y)
    mainFrame.Position = UDim2.new(0.5, -mainSize.X / 2, 0.5, -mainSize.Y / 2)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    mainFrame.Visible = not keySystem
    mainFrame.Active = true
    mainFrame.Draggable = true

    local mainStroke = Instance.new("UIStroke")
    mainStroke.Thickness = 2
    mainStroke.Color = mainColor
    mainStroke.Parent = mainFrame

    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0, 10)
    mainCorner.Parent = mainFrame

    -- Title Label (Left-Aligned)
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(0.5, 0, 0, 50)
    titleLabel.Position = UDim2.new(0, 10, 0, 10)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.Font = Enum.Font.GothamBlack
    titleLabel.TextSize = 24
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = mainFrame

    -- Tab Container
    local tabContainer = Instance.new("Frame")
    tabContainer.Size = UDim2.new(0.25, 0, 0.75, 0)
    tabContainer.Position = UDim2.new(0, 10, 0.2, 0)
    tabContainer.BackgroundTransparency = 1
    tabContainer.Parent = mainFrame

    local tabList = Instance.new("UIListLayout")
    tabList.SortOrder = Enum.SortOrder.LayoutOrder
    tabList.Parent = tabContainer

    -- Content Frame
    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(0.7, 0, 0.75, 0)
    contentFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
    contentFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    contentFrame.Parent = mainFrame

    local contentCorner = Instance.new("UICorner")
    contentCorner.CornerRadius = UDim.new(0, 8)
    contentCorner.Parent = contentFrame

    local pages = {}

    -- Key System Logic
    keySubmit.MouseButton1Click:Connect(function()
        if keyInput.Text == key then
            createTween(keyFrame, {Transparency = 1}, 0.5)
            keyFrame.Visible = false
            mainFrame.Visible = true
            createTween(mainFrame, {Transparency = 0}, 0.5)
        else
            keyInput.Text = ""
            keyInput.PlaceholderText = "Invalid Key!"
            createTween(keyInput, {BackgroundColor3 = Color3.fromRGB(255, 50, 50)}, 0.3)
            wait(0.3)
            createTween(keyInput, {BackgroundColor3 = Color3.fromRGB(40, 40, 40)}, 0.3)
        end
    end)

    -- Toggle UI Visibility (Insert Key)
    local uiVisible = false
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == Enum.KeyCode.Insert then
            uiVisible = not uiVisible
            mainFrame.Visible = uiVisible
            createTween(mainFrame, {Transparency = uiVisible and 0 or 1}, 0.3)
        end
    end)

    -- Window Object
    local window = {}
    
    function window:AddTab(name)
        local tabButton = Instance.new("TextButton")
        tabButton.Size = UDim2.new(1, 0, 0, 40)
        tabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        tabButton.Text = name
        tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        tabButton.Font = Enum.Font.Gotham
        tabButton.TextSize = 16
        tabButton.LayoutOrder = #tabContainer:GetChildren()
        tabButton.Parent = tabContainer

        local tabCorner = Instance.new("UICorner")
        tabCorner.CornerRadius = UDim.new(0, 5)
        tabCorner.Parent = tabButton

        local page = Instance.new("Frame")
        page.Size = UDim2.new(1, 0, 1, 0)
        page.BackgroundTransparency = 1
        page.Visible = false
        page.Parent = contentFrame

        local scrollingFrame = Instance.new("ScrollingFrame")
        scrollingFrame.Size = UDim2.new(1, 0, 1, 0)
        scrollingFrame.BackgroundTransparency = 1
        scrollingFrame.ScrollBarThickness = 6
        scrollingFrame.CanvasSize = UDim2.new(0, 0, 2, 0)
        scrollingFrame.Parent = page

        local uiListLayout = Instance.new("UIListLayout")
        uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
        uiListLayout.Padding = UDim.new(0, 10)
        uiListLayout.Parent = scrollingFrame

        pages[name] = page

        tabButton.MouseButton1Click:Connect(function()
            for _, p in pairs(pages) do
                p.Visible = false
            end
            page.Visible = true
            createTween(tabButton, {BackgroundColor3 = mainColor}, 0.3)
            for _, btn in pairs(tabContainer:GetChildren()) do
                if btn:IsA("TextButton") and btn ~= tabButton then
                    createTween(btn, {BackgroundColor3 = Color3.fromRGB(40, 40, 40)}, 0.3)
                end
            end
        end)

        -- Initialize first tab
        if #tabContainer:GetChildren() == 1 then
            page.Visible = true
            createTween(tabButton, {BackgroundColor3 = mainColor}, 0)
        end

        -- Tab Object
        local tab = {}

        function tab:AddButton(name, callback)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, -20, 0, 40)
            button.BackgroundColor3 = mainColor
            button.Text = name
            button.TextColor3 = Color3.fromRGB(255, 255, 255)
            button.Font = Enum.Font.GothamBold
            button.TextSize = 16
            button.Parent = scrollingFrame

            local buttonCorner = Instance.new("UICorner")
            buttonCorner.CornerRadius = UDim.new(0, 5)
            buttonCorner.Parent = button

            button.MouseButton1Click:Connect(function()
                createTween(button, {BackgroundColor3 = mainColor:Lerp(Color3.fromRGB(255, 255, 255), 0.2)}, 0.2)
                wait(0.2)
                createTween(button, {BackgroundColor3 = mainColor}, 0.2)
                if callback then callback() end
            end)

            return button
        end

        function tab:AddToggle(name, callback)
            local toggleFrame = Instance.new("Frame")
            toggleFrame.Size = UDim2.new(1, -20, 0, 40)
            toggleFrame.BackgroundTransparency = 1
            toggleFrame.Parent = scrollingFrame

            local toggleLabel = Instance.new("TextLabel")
            toggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
            toggleLabel.BackgroundTransparency = 1
            toggleLabel.Text = name
            toggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            toggleLabel.Font = Enum.Font.Gotham
            toggleLabel.TextSize = 16
            toggleLabel.Parent = toggleFrame

            local toggleButton = Instance.new("TextButton")
            toggleButton.Size = UDim2.new(0, 60, 0, 30)
            toggleButton.Position = UDim2.new(0.8, 0, 0.1, 0)
            toggleButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
            toggleButton.Text = ""
            toggleButton.Parent = toggleFrame

            local toggleKnob = Instance.new("Frame")
            toggleKnob.Size = UDim2.new(0.5, 0, 0.8, 0)
            toggleKnob.Position = UDim2.new(0.1, 0, 0.1, 0)
            toggleKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            toggleKnob.Parent = toggleButton

            local toggleCorner = Instance.new("UICorner")
            toggleCorner.CornerRadius = UDim.new(0, 15)
            toggleCorner.Parent = toggleButton

            local knobCorner = Instance.new("UICorner")
            knobCorner.CornerRadius = UDim.new(0, 12)
            knobCorner.Parent = toggleKnob

            local toggleState = false
            toggleButton.MouseButton1Click:Connect(function()
                toggleState = not toggleState
                local newPos = toggleState and UDim2.new(0.5, 0, 0.1, 0) or UDim2.new(0.1, 0, 0.1, 0)
                local newColor = toggleState and mainColor or Color3.fromRGB(80, 80, 80)
                createTween(toggleKnob, {Position = newPos}, 0.3)
                createTween(toggleButton, {BackgroundColor3 = newColor}, 0.3)
                if callback then callback(toggleState) end
            end)

            return toggleButton
        end

        function tab:AddTextBox(name, callback)
            local textbox = Instance.new("TextBox")
            textbox.Size = UDim2.new(1, -20, 0, 40)
            textbox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            textbox.Text = ""
            textbox.PlaceholderText = name
            textbox.TextColor3 = Color3.fromRGB(255, 255, 255)
            textbox.Font = Enum.Font.Gotham
            textbox.TextSize = 16
            textbox.Parent = scrollingFrame

            local textboxCorner = Instance.new("UICorner")
            textboxCorner.CornerRadius = UDim.new(0, 5)
            textboxCorner.Parent = textbox

            textbox.FocusLost:Connect(function(enterPressed)
                if enterPressed and callback then
                    callback(textbox.Text)
                end
            end)

            return textbox
        end

        function tab:AddDropdown(name, callback)
            local dropdownFrame = Instance.new("Frame")
            dropdownFrame.Size = UDim2.new(1, -20, 0, 40)
            dropdownFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            dropdownFrame.Parent = scrollingFrame

            local dropdownCorner = Instance.new("UICorner")
            dropdownCorner.CornerRadius = UDim.new(0, 5)
            dropdownCorner.Parent = dropdownFrame

            local dropdownButton = Instance.new("TextButton")
            dropdownButton.Size = UDim2.new(1, 0, 1, 0)
            dropdownButton.BackgroundTransparency = 1
            dropdownButton.Text = name
            dropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            dropdownButton.Font = Enum.Font.Gotham
            dropdownButton.TextSize = 16
            dropdownButton.Parent = dropdownFrame

            local dropdownList = Instance.new("Frame")
            dropdownList.Size = UDim2.new(1, 0, 0, 120)
            dropdownList.Position = UDim2.new(0, 0, 1, 5)
            dropdownList.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            dropdownList.Visible = false
            dropdownList.Parent = dropdownFrame

            local dropdownListCorner = Instance.new("UICorner")
            dropdownListCorner.CornerRadius = UDim.new(0, 5)
            dropdownListCorner.Parent = dropdownList

            local dropdownListLayout = Instance.new("UIListLayout")
            dropdownListLayout.SortOrder = Enum.SortOrder.LayoutOrder
            dropdownListLayout.Padding = UDim.new(0, 5)
            dropdownListLayout.Parent = dropdownList

            dropdownButton.MouseButton1Click:Connect(function()
                dropdownList.Visible = not dropdownList.Visible
                createTween(dropdownList, {Transparency = dropdownList.Visible and 0 or 1}, 0.3)
            end)

            local dropdown = {}
            function dropdown:Add(option)
                local optionButton = Instance.new("TextButton")
                optionButton.Size = UDim2.new(1, 0, 0, 30)
                optionButton.BackgroundTransparency = 1
                optionButton.Text = option
                optionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
                optionButton.Font = Enum.Font.Gotham
                optionButton.TextSize = 14
                optionButton.Parent = dropdownList

                optionButton.MouseButton1Click:Connect(function()
                    dropdownButton.Text = option
                    dropdownList.Visible = false
                    createTween(dropdownList, {Transparency = 1}, 0.3)
                    if callback then callback(option) end
                end)
            end

            return dropdown
        end

        function tab:AddKeybind(name, callback)
            local keybindFrame = Instance.new("Frame")
            keybindFrame.Size = UDim2.new(1, -20, 0, 40)
            keybindFrame.BackgroundTransparency = 1
            keybindFrame.Parent = scrollingFrame

            local keybindLabel = Instance.new("TextLabel")
            keybindLabel.Size = UDim2.new(0.7, 0, 1, 0)
            keybindLabel.BackgroundTransparency = 1
            keybindLabel.Text = name
            keybindLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            keybindLabel.Font = Enum.Font.Gotham
            keybindLabel.TextSize = 16
            keybindLabel.Parent = keybindFrame

            local keybindButton = Instance.new("TextButton")
            keybindButton.Size = UDim2.new(0.3, 0, 1, 0)
            keybindButton.Position = UDim2.new(0.7, 0, 0, 0)
            keybindButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            keybindButton.Text = "None"
            keybindButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            keybindButton.Font = Enum.Font.Gotham
            keybindButton.TextSize = 16
            keybindButton.Parent = keybindFrame

            local keybindCorner = Instance.new("UICorner")
            keybindCorner.CornerRadius = UDim.new(0, 5)
            keybindCorner.Parent = keybindButton

            local waitingForKey = false
            keybindButton.MouseButton1Click:Connect(function()
                waitingForKey = true
                keybindButton.Text = "Press a Key"
            end)

            UserInputService.InputBegan:Connect(function(input, gameProcessed)
                if waitingForKey and not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard then
                    keybindButton.Text = input.KeyCode.Name
                    waitingForKey = false
                    if callback then callback(input.KeyCode) end
                end
            end)

            return keybindButton
        end

        function tab:AddLabel(text)
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -20, 0, 30)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Color3.fromRGB(255, 255, 255)
            label.Font = Enum.Font.Gotham
            label.TextSize = 16
            label.Parent = scrollingFrame

            return label
        end

        function tab:AddSlider(name, callback, config)
            local sliderConfig = config or {min = 0, max = 100}
            local min = sliderConfig.min or 0
            local max = sliderConfig.max or 100

            local sliderFrame = Instance.new("Frame")
            sliderFrame.Size = UDim2.new(1, -20, 0, 40)
            sliderFrame.BackgroundTransparency = 1
            sliderFrame.Parent = scrollingFrame

            local sliderLabel = Instance.new("TextLabel")
            sliderLabel.Size = UDim2.new(0.7, 0, 1, 0)
            sliderLabel.BackgroundTransparency = 1
            sliderLabel.Text = name .. ": " .. min
            sliderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            sliderLabel.Font = Enum.Font.Gotham
            sliderLabel.TextSize = 16
            sliderLabel.Parent = sliderFrame

            local sliderBar = Instance.new("Frame")
            sliderBar.Size = UDim2.new(0.3, 0, 0, 10)
            sliderBar.Position = UDim2.new(0.7, 0, 0.5, -5)
            sliderBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            sliderBar.Parent = sliderFrame

            local sliderCorner = Instance.new("UICorner")
            sliderCorner.CornerRadius = UDim.new(0, 5)
            sliderCorner.Parent = sliderBar

            local sliderKnob = Instance.new("Frame")
            sliderKnob.Size = UDim2.new(0, 20, 0, 20)
            sliderKnob.Position = UDim2.new(0, -10, 0, -5)
            sliderKnob.BackgroundColor3 = mainColor
            sliderKnob.Parent = sliderBar

            local knobCorner = Instance.new("UICorner")
            knobCorner.CornerRadius = UDim.new(0, 10)
            knobCorner.Parent = sliderKnob

            local sliderValue = min
            local isDragging = false

            local function updateSlider(inputPosition)
                local barSize = sliderBar.AbsoluteSize.X
                local barPos = sliderBar.AbsolutePosition.X
                local relativeX = math.clamp((inputPosition.X - barPos) / barSize, 0, 1)
                sliderValue = math.floor(min + (max - min) * relativeX)
                sliderLabel.Text = name .. ": " .. sliderValue
                createTween(sliderKnob, {Position = UDim2.new(relativeX, -10, 0, -5)}, 0.1)
                if callback then callback(sliderValue) end
            end

            -- PC Input
            sliderKnob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    isDragging = true
                    updateSlider(input.Position)
                end
            end)

            sliderKnob.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    isDragging = false
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    updateSlider(input.Position)
                end
            end)

            -- Mobile Input
            sliderKnob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.Touch then
                    isDragging = true
                    updateSlider(input.Position)
                end
            end)

            sliderKnob.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.Touch then
                    isDragging = false
                end
            end)

            UserInputService.TouchMoved:Connect(function(input)
                if isDragging then
                    updateSlider(input.Position)
                end
            end)

            local slider = {}
            function slider:Set(value)
                value = math.clamp(value, min, max)
                sliderValue = value
                sliderLabel.Text = name .. ": " .. sliderValue
                local relativeX = (value - min) / (max - min)
                createTween(sliderKnob, {Position = UDim2.new(relativeX, -10, 0, -5)}, 0.1)
                if callback then callback(sliderValue) end
            end

            return slider
        end

        return tab
    end

    return window
end

return library
